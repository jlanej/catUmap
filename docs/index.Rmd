---
title: "CatUMap"
author: "JL"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=8)
library(data.table)
library(plotly)
library(skimr)
library(sp)
library(rworldmap)

theme_set(theme_bw(10))


dfWithIndicesCache = "../output/data.with.indices.Rdata"
if (!file.exists(dfWithIndicesCache)) {
  df <- fread("../output/umap_100_100_euclidean.cluster_x_y_z_Speed.tf_TRUE.txt.gz")
  
  countriesSP <- getMap(resolution = 'low')
  pointsSP = SpatialPoints(df[, c("lon", "lat")], proj4string = CRS(proj4string(countriesSP)))
  indices = over(pointsSP, countriesSP)
  df = cbind(df, indices)
  # save(df, file = dfWithIndicesCache)
  url = 'https://www2.census.gov/geo/tiger/GENZ2020/shp/cb_2020_us_county_500k.zip'
  download.file(url, destfile = "../output/cb_2020_us_county_500k.zip")
  unzip("../output/cb_2020_us_county_500k.zip", exdir = "../output/")
  shape <- read_sf("../output/cb_2020_us_county_500k.shp")
  
}
load(dfWithIndicesCache)

```

## summary

```{r}
skim(df)

```

## Cat umaps

```{r echo=FALSE,dev='jpeg',dpi=300}
# set point size to 0.5 for all plots
size <- 0.1
dfUSA = df[df$GU_A3 == "USA", ]


p <-
  ggplot(dfUSA, aes(x = umap_1, y = umap_2, color = Name)) + geom_point(alpha =
                                                                          0.5, size = size)
p


p <-
  ggplot(dfUSA, aes(x = umap_1, y = umap_2, color = Activity)) + geom_point(alpha =
                                                                              0.5, size = size)
p

p + facet_wrap( ~ Activity)
p + facet_wrap(~ Name)

```
